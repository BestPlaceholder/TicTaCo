<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>TicTaCoWeb.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TicTaCo</a> &gt; <a href="index.source.html" class="el_package">is.placeholder.tictactoe</a> &gt; <span class="el_source">TicTaCoWeb.java</span></div><h1>TicTaCoWeb.java</h1><pre class="source lang-java linenums">package is.placeholder.tictactoe;

import spark.*;
import static spark.Spark.*;
import spark.servlet.SparkApplication;

<span class="nc" id="L7">public class TicTaCoWeb implements SparkApplication {</span>
    public static void main(String[] args){
<span class="nc" id="L9">        staticFileLocation(&quot;/public&quot;);</span>
<span class="nc" id="L10">        SparkApplication tictacoweb = new TicTaCoWeb();</span>
<span class="nc" id="L11">        String port = System.getenv(&quot;PORT&quot;);</span>
<span class="nc bnc" id="L12" title="All 2 branches missed.">        if (port != null) {</span>
<span class="nc" id="L13">            setPort(Integer.valueOf(port));</span>
        }
<span class="nc" id="L15">        tictacoweb.init(); </span>
<span class="nc" id="L16">    }</span>

    private TicTacToe ticTacToe;

    public void init(){
        
<span class="nc" id="L22">        post(new Route(&quot;/playtic&quot;){</span>
            @Override
            public Object handle(Request request, Response response){
                // Get the coordinates of the tile that was clicked
<span class="nc" id="L26">                String tile = request.queryParams(&quot;tile&quot;);</span>
<span class="nc" id="L27">                int tileX = Integer.parseInt(tile.substring(4, 5));</span>
<span class="nc" id="L28">                int tileY = Integer.parseInt(tile.substring(5, 6));</span>

                // Account for diffrence between tiles and arrays
<span class="nc" id="L31">                tileX--;tileY--;</span>

                // Make the player move, if invalid, return
                String playerMove;
<span class="nc bnc" id="L35" title="All 2 branches missed.">                if (ticTacToe.humanPlayerMove(tileX, tileY) != null)</span>
<span class="nc" id="L36">                    playerMove = Integer.toString(++tileX) + Integer.toString(++tileY) + &quot; x&quot;;</span>
                else
<span class="nc" id="L38">                    return &quot; &quot;;</span>
                
                // Make the computer move
<span class="nc" id="L41">                String computerMove = null;</span>
<span class="nc" id="L42">                int[] computerMoveCoordinates = ticTacToe.computerMove(ticTacToe.grid);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">                if (computerMoveCoordinates != null)</span>
<span class="nc" id="L44">                    computerMove = Integer.toString(++computerMoveCoordinates[0]) + </span>
                        Integer.toString(++computerMoveCoordinates[1]) + &quot; o&quot;;
                else
<span class="nc" id="L47">                    computerMove = playerMove; // Say the same move if computer does nothing</span>

                // Check for win
<span class="nc" id="L50">                String scores = null;</span>
<span class="nc" id="L51">                int gameEnd = ticTacToe.hasWon();</span>
                // If there is a win, send the update score to the web
<span class="nc bnc" id="L53" title="All 2 branches missed.">                if (gameEnd != 0) {</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">                    if (gameEnd == 1)</span>
<span class="nc" id="L55">                        scores = &quot; &quot; + Integer.toString(ticTacToe.getPlayerScore());</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">                    else if (gameEnd == 2)</span>
<span class="nc" id="L57">                        scores = &quot; 0 &quot; + Integer.toString(ticTacToe.getComputerScore());</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">                    else if (gameEnd == 3)</span>
<span class="nc" id="L59">                        scores = &quot; 0 0 &quot; + Integer.toString(ticTacToe.getTieScore());</span>
                }

<span class="nc" id="L62">                return playerMove + &quot; &quot; + computerMove + scores;</span>
            }
        });
        
<span class="nc" id="L66">        post(new Route(&quot;/selectdifficulty&quot;){</span>
            @Override
            public Object handle(Request request, Response response){
<span class="nc" id="L69">                String difficulty = request.queryParams(&quot;option&quot;);</span>

                // Create a new game with the desired difficulty
<span class="nc bnc" id="L72" title="All 2 branches missed.">                if (difficulty == &quot;easy&quot;)</span>
<span class="nc" id="L73">                    ticTacToe = new TicTacToe(true, false);</span>
                else
<span class="nc" id="L75">                    ticTacToe = new TicTacToe(true, false);</span>

                // Create the grid
<span class="nc" id="L78">                ticTacToe.makeGrid();</span>

<span class="nc" id="L80">                return &quot; &quot;;</span>
            }
        });
<span class="nc" id="L83">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>